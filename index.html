<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Hello World!</title>
    <!-- https://electronjs.org/docs/tutorial/security#csp-meta-tag -->
    <meta
      http-equiv="Content-Security-Policy"
      content="script-src 'self' 'unsafe-inline';"
    />
    <style>
      main {
        display: flex;
      }
      section {
        width: 100%;
      }
      #app-grid {
        display: flex;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <main>
      <develop-folder></develop-folder>
      <section>
        <nav>NAV</nav>
        <div id="app-grid">
          <button onclick="back()">back</button>
        </div>
      </section>
    </main>
    <script src="app.js"></script>
    <script>
      document.addEventListener(
        "DOMContentLoaded",
        function () {
          const readDirectoryFilenames = require("./system/index")
            .readDirectoryFilenames;
          const buildAbsolutePath = require("./system/index").buildAbsolutePath;
          const FolderList = require("./ui/components/FolderList");
          const DevelopFolder = require("./ui/components/DevelopFolder");
          const main = document.getElementsByTagName("main")[0];
          const grid = document.getElementById("app-grid");

          let currentFolderPath = [];
          let currentLevel = 0;

          const addNewColumn = (filenames) => {
            console.log("add");
            const column = new FolderList(filenames, currentFolderPath.length);
            const appGrid = document.getElementById("app-grid");
            appGrid.appendChild(column);
          };

          const removeColumns = (count = 0) => {
            console.log("remove", count);
            currentFolderPath.slice(0, currentFolderPath.length - count);
            const appGrid = document.getElementById("app-grid");
          };

          const replaceColumn = (item) => {
            console.log("replace", item, currentFolderPath);
            currentFolderPath.splice(-1, 1, item);
            console.log("replace", item, currentFolderPath);
          };

          const back = () => {
            let newPath = currentFolderPath.slice(
              0,
              currentFolderPath.length - 1
            );
            removeColumns();
          };
          main.addEventListener("onOpenFolder", (event) => {
            console.log("CATCH", document.querySelector("#app-grid"));
            const clickedColumn = event.detail.level;
            console.log(event.detail.level, currentFolderPath.length);

            if (event.detail.level < currentFolderPath.length) {
              removeColumns(-1);
              replaceColumn(event.detail.item);
              const path = buildAbsolutePath(`${currentFolderPath.join("/")}`);
              readDirectoryFilenames(path).then((filenames) => {
                addNewColumn(filenames);
              });
            } else {
              currentFolderPath.push(event.detail.item);
              const path = buildAbsolutePath(`${currentFolderPath.join("/")}`);
              readDirectoryFilenames(path).then((filenames) => {
                addNewColumn(filenames);
              });
            }
          });
          // your code goes here
        },
        false
      );
    </script>
  </body>
</html>
